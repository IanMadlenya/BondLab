{
    "contents" : "\n# graph 9.1\n\nLoanAge.Vector <- data.frame(c(seq(1, 180, 1)))\nSeason.Vector <- 6 * Seasoning( alpha = 1, beta = 0.87, theta = 0.192, LoanAge = LoanAge.Vector[,1])\nLoanAge.Vector <- data.frame(cbind(LoanAge.Vector, Season.Vector))\ncolnames(LoanAge.Vector) <- c(\"LoanAge\", \"Seasoning\")\n\n\nggplot(subset(LoanAge.Vector, LoanAge <= 60), aes(x=LoanAge, y = Seasoning)) +\n  geom_line() +\n  theme_minimal() +\n  ylab(\"CPR (%)\")+\n  xlab(\"Loan Age\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20))\n\n\n#graph 9.2\nSeasonal <- read.csv(\"~/BondLabData/PrepaymentData/Seasonal.csv\")\nMonth.Vector <- c(seq(1, 12, 1))\nSeasonals <- Seasonality( alpha = .15, Month = Month.Vector, theta = 12)\n\nSeasonal.Data <- data.frame(cbind(Month.Vector, Seasonals))\ncolnames(Seasonal.Data) <- c(\"Month\" , \"Seasonal\") \nSeasonal.Data$Month <-c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \n                        \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")\nSeasonal.Data$Month <- factor(Seasonal.Data$Month, \n                              levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \n                                         \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"))\n\nSeasonal.Factor <- data.frame(cbind(Seasonal[1], Seasonal[6]/mean(Seasonal[,6])))\ncolnames(Seasonal.Factor) <- c(\"Month\", \"Seasonal\")\nSeasonal.Factor$Month <- factor(Seasonal.Data$Month, \n                                levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \n                                           \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"))\n\nggplot(Seasonal.Factor, aes(x=factor(Month), y = Seasonal)) +\n  geom_bar(fill = \"grey\", stat = \"identity\", alpha = .75) +\n  geom_point(data = Seasonal.Data, aes(x = Month, y = Seasonal), size = 8, colour = \"black\", alpha = .45) +\n  geom_line(data = Seasonal.Data, aes(x = as.numeric(Month), y = Seasonal), size = 1, colour = \"black\") +\n  theme_minimal() +\n  ylab(\"Seasonal Factor\")+\n  xlab(\"Month\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) \n\n# graph 9.3\nIncentive.Vector <- seq(-3, 3, .25)\n\nIncentive.CPR <- Borrower.Incentive(incentive = Incentive.Vector, location = 0, beta = 0, theta1 = 0, theta2 = 1)\nIncentiveData <- data.frame(cbind(Incentive.Vector, Incentive.CPR))\nIncentiveData$CPR1 <- Borrower.Incentive(incentive = Incentive.Vector, location = 0, beta = -1, theta1 = 0, theta2 = 1)\nIncentiveData$CPR2 <- Borrower.Incentive(incentive = Incentive.Vector, location = 0, beta = -2, theta1 = 0, theta2 = 1)\nIncentiveData$CPR3 <- Borrower.Incentive(incentive = Incentive.Vector, location = 0, beta = -3, theta1 = 0, theta2 = 1)\n\nIncentive.Slope <- melt(IncentiveData, id = \"Incentive.Vector\")\n\nggplot(Incentive.Slope, aes(x=Incentive.Vector, y = value, linetype = variable)) +\n  geom_line() +\n  theme_minimal() +\n  ylab(\"arctan Response\")+\n  xlab(\"Borrower Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.92, .20)) +\n  scale_linetype(labels = c(\"0,0\", \"0,-1\", \"0,-2\", \"0,-3\"), name = \"Legend (location,beta)\") \n\n# graph 9.4\n\nIncentive.CPR <- Borrower.Incentive(incenitve = Incentive.Vector, location = 0, beta = -1, theta1 = 0, theta2 = 1)\nIncentiveData <- data.frame(cbind(Incentive.Vector, Incentive.CPR))\nIncentiveData$CPR1 <- Borrower.Incentive(incentive = Incentive.Vector, location = -1, beta = -1, theta1 = 0, theta2 = 1)\nIncentiveData$CPR2 <- Borrower.Incentive(incentive = Incentive.Vector, location = 0, beta = -2, theta1 = 0, theta2 = 1)\nIncentiveData$CPR3 <- Borrower.Incentive(incentive = Incentive.Vector, location = 1, beta = -3, theta1 = 0, theta2 = 1)\n\nIncentive.Location <- melt(IncentiveData, id = \"Incentive.Vector\")\n\n\nggplot(Incentive.Location, aes(x=Incentive.Vector, y = value, linetype = variable)) +\n  geom_line() +\n  theme_minimal() +\n  ylab(\"arctan Response\")+\n  xlab(\"Borrower Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.92, .20)) +\n  scale_linetype(labels = c(\"0,-1\", \"-1,-1\", \"0,-2\", \"1,-3\"), name = \"Legend (location,beta)\")\n\n\nIncentive <- read.csv(\"~/BondLabData/PrepaymentData/Incentive.csv\")\n\n# graph 9.5\nIncentive.Function <- Borrower.Incentive(incentive = Incentive.Vector, location = -.5, beta = -1, theta1 = 0.0167, theta2 = .008)\nIncentive.Function <- data.frame(cbind(Incentive.Vector, Incentive.Function))\n\nIncentive.Fit <- data.frame(cbind(Incentive[1]/100, Incentive[6],                      \n        Borrower.Incentive(incentive = Incentive[1]/100, location = .5, beta = -2.67, theta1 = 0.0167, theta2 = .008)))\n\nIncentive.Fit[3] <- (1-(1-Incentive.Fit[3]) ^12) * 100\ncolnames(Incentive.Fit) <- c(\"Incentive\", \"CPR\", \"Fit\")\n\nIncentive.Fit <- melt(Incentive.Fit, id = \"Incentive\")\n\nggplot(Incentive.Fit, aes(x=Incentive, y = value, linetype = variable, shape = variable)) +\n  geom_point(size = 3) +\n  stat_smooth(method = loess, colour = \"black\", se = FALSE) +\n  theme_minimal() +\n  ylab(\"Borrower Response\")+\n  xlab(\"Borrower Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.8, .2), legend.background = element_rect(fill = 'white')) +\n  scale_linetype(labels = c(\"Actual CPR\", \"Model Response CPR\"), name = \"Loess Fit\") +\n  scale_shape(labels = c(\"Actual CPR\", \"Model Response CPR\"), name = \"Legend\") \n\n# graph 9.6\n\nIncentive.Function <- Borrower.Incentive(incentive = Incentive.Vector, location = -.5, beta = -1, theta1 = 0.0167, theta2 = .008)\nIncentive.Function <- data.frame(cbind(Incentive.Vector, Incentive.Function))\n\nIncentive.Fit <- data.frame(cbind(Incentive[1]/100, Incentive[6],                      \n            Borrower.Incentive(incentive = Incentive[1]/100, location = .75, beta = -6, theta1 = 0.019, theta2 = .01)))\n\nIncentive.Fit[3] <- (1-(1-Incentive.Fit[3]) ^12) * 100\ncolnames(Incentive.Fit) <- c(\"Incentive\", \"CPR\", \"Fit\")\n\nIncentive.Fit <- melt(Incentive.Fit, id = \"Incentive\")\n\nggplot(Incentive.Fit, aes(x=Incentive, y = value, linetype = variable, shape = variable)) +\n  geom_point(size = 3) +\n  stat_smooth(method = loess, colour = \"black\", se = FALSE) +\n  theme_minimal() +\n  ylab(\"Borrower Response\")+\n  xlab(\"Borrower Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.8, .2), legend.background = element_rect(fill = 'white')) +\n  scale_linetype(labels = c(\"Actual CPR\", \"Model Response CPR\"), name = \"Loess Fit\") +\n  scale_shape(labels = c(\"Actual CPR\", \"Model Response CPR\"), name = \"Legend\") \n\n# graph 9.7\n\nIncentiveAge <- read.csv(\"~/BondLabData/PrepaymentData/IncentiveAge.csv\")\nIncentiveAge <- subset(IncentiveAge, Incentive >= -150)\n\nIncentive.Age <- IncentiveAge\nIncentive.Age <- Incentive.Age[,-2]\nIncentive.Age <- Incentive.Age[,-2]\nIncentive.Age <- Incentive.Age[,-2]\nIncentive.Age <- Incentive.Age[,-2]\n\nIncentive.Age <- melt(Incentive.Age, id = \"Incentive\")\n\n\nggplot(IncentiveAge, aes(x=Incentive, y = CPR, linetype = Seasoning)) +\n  stat_smooth(method = loess, colour = \"black\", se = FALSE, size = .5) +\n  theme_minimal() +\n  ylab(\"CPR (%)\")+\n  xlab(\"Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.85, .2)) +\n  scale_linetype(name = \"Legend\") \n\n# graph 9.8\nBurn.Out <- data.frame(c(seq(-300, 300, 50)))\nBurn.Out[,2] <- cbind(Borrower.Incentive(incentive = Burn.Out[1]/100, location = .75, beta = -3, theta1 = 0.023, theta2 = .014))\nBurn.Out[,2] <- 1-(1-Burn.Out[,2])^12\nBurn.Out[,3] <- cbind(Borrower.Incentive(incentive = Burn.Out[1]/100, location = 1.5, beta = -1.5, theta1 = 0.017, theta2 = .010))\nBurn.Out[,3] <- 1-(1-Burn.Out[,3])^12\ncolnames(Burn.Out) <- c(\"Incentive\", \"Fast Payer\", \"Slow Payer\")\n\nBurn.Out <- melt(Burn.Out, id = \"Incentive\")\n\nggplot(Burn.Out, aes(x=Incentive, y = value * 100, linetype = variable)) +\n  stat_smooth(method = loess, colour = \"black\", se = FALSE, size = .5) +\n  theme_minimal() +\n  ylab(\"CPR (%)\")+\n  xlab(\"Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.9, .1)) +\n  scale_linetype(name = \"Legend\") \n\n#graph 9.9\nBO.Vector <- data.frame(c(seq(1,360,1)))\nBO.Vector[,2] <- cbind(Burnout(beta1 = -.05, beta2 = 0, MaxIncen = 25, Age = BO.Vector[,1]))\nBO.Vector[,3] <- cbind(Burnout(beta1 = -.04, beta2 = 0, MaxIncen = 25, Age = BO.Vector[,1]))\nBO.Vector[,4] <- cbind(Burnout(beta1 = -.03, beta2 = 0, MaxIncen = 25, Age = BO.Vector[,1]))\nBO.Vector[,5] <- cbind(Burnout(beta1 = -.02, beta2 = 0, MaxIncen = 25, Age = BO.Vector[,1]))\nBO.Vector[,6] <- cbind(Burnout(beta1 = -.01, beta2 = 0, MaxIncen = 25, Age = BO.Vector[,1]))\ncolnames(BO.Vector) <- c(\"Loan Age\", \"-.05\", \"-.04\", \"-.03\", \"-.02\", \"-.01\")\nBO.Vector <- melt(BO.Vector, id = \"Loan Age\")\n\nggplot(BO.Vector, aes(x= BO.Vector[,1], y = value, linetype = variable)) +\n  geom_line()+\n  theme_minimal() +\n  ylab(\"Burnout\")+\n  xlab(\"Loan Age\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.9, .4)) +\n  scale_linetype(labels = c(-.05, -.04, -.03, -.02, -.01), name = \"Beta 1\") \n\n# graph 9.10\nBO.Vector <- data.frame(c(seq(1,360,1)))\nBO.Vector[,2] <- cbind(Burnout(beta1 = -.01, beta2 = -.05, MaxIncen = 25, LoanAge = BO.Vector[,1]))\nBO.Vector[,3] <- cbind(Burnout(beta1 = -.01, beta2 = -.04, MaxIncen = 25, LoanAge = BO.Vector[,1]))\nBO.Vector[,4] <- cbind(Burnout(beta1 = -.01, beta2 = -.03, MaxIncen = 25, LoanAge = BO.Vector[,1]))\nBO.Vector[,5] <- cbind(Burnout(beta1 = -.01, beta2 = -.03, MaxIncen = 25, LoanAge = BO.Vector[,1]))\nBO.Vector[,6] <- cbind(Burnout(beta1 = -.01, beta2 = -.01, MaxIncen = 25, LoanAge = BO.Vector[,1]))\ncolnames(BO.Vector) <- c(\"Loan Age\", \"-.05\", \"-.04\", \"-.03\", \"-.02\", \"-.01\")\nBO.Vector <- melt(BO.Vector, id = \"Loan Age\")\n\nggplot(BO.Vector, aes(x= BO.Vector[,1], y = value, linetype = variable)) +\n  geom_line()+\n  theme_minimal() +\n  ylab(\"Burnout\")+\n  xlab(\"Loan Age\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.9, .4)) +\n  scale_linetype(labels = c(-.05, -.04, -.03, -.02, -.01), name = \"Beta 2\") \n\n\n# graph 9.11\nLoanAge.Vector <- data.frame(c(seq(1, 180, 1)))\nSeason.Vector <- 1 * Seasoning( alpha = 1, beta = 0.87, theta = 0.192, LoanAge = LoanAge.Vector[,1])\nLoanAge.Vector <- data.frame(cbind(LoanAge.Vector, Season.Vector))\ncolnames(LoanAge.Vector) <- c(\"LoanAge\", \"Seasoning\")\n\n  ggplot(subset(LoanAge.Vector, LoanAge <= 60), aes(x=LoanAge, y = Seasoning)) +\n  geom_line(linetype = 1) +\n  theme_minimal() +\n  ylab(\"CPR (%)\")+\n  xlab(\"Loan Age\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20))\n\n\n# graph 9.12\nMonth.Vector <- c(seq(1, 12, 1))\nSeasonals <- Seasonality( alpha = .15, Month = Month.Vector, theta = 12)\n\nSeasonal.Data <- data.frame(cbind(Month.Vector, Seasonals))\ncolnames(Seasonal.Data) <- c(\"Month\" , \"Seasonal\") \nSeasonal.Data$Month <-c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \n                        \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")\nSeasonal.Data$Month <- factor(Seasonal.Data$Month, \n                              levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \n                                         \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"))\n\nggplot(Seasonal.Data, aes(x=factor(Month), y = Seasonal)) +\n  geom_bar(fill = \"grey\", stat = \"identity\", alpha = .75) +\n  geom_point(data = Seasonal.Data, aes(x = Month, y = Seasonal), size = 8, colour = \"black\", alpha = .45) +\n  geom_line(data = Seasonal.Data, aes(x = as.numeric(Month), y = Seasonal), size = 1, colour = \"black\") +\n  theme_minimal() +\n  ylab(\"Seasonal Factor\")+\n  xlab(\"Month\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) \n\n\n# graph 13 Fast Payer Slow Payer\nFastSlow.Payer <- data.frame(c(seq(-300, 300, 25)))\nFastSlow.Payer[2] <- Borrower.Incentive(FastSlow.Payer[1]/100, theta1 = 0.025, theta2 = 0.019, beta = -4, location = 1)\nFastSlow.Payer[3] <- Borrower.Incentive(FastSlow.Payer[1]/100, theta1 = 0.001, theta2 = 0.004, beta = -1, location = .5)\ncolnames(FastSlow.Payer) <- c(\"Incentive\", \"FastPayer\", \"SlowPayer\")\nFastSlow.Payer <- melt(FastSlow.Payer, id = \"Incentive\")\n\nggplot(FastSlow.Payer, aes(x=Incentive, y = value , shape = variable)) +\n  geom_point(size = 5, colour = \"black\", alpha = .5) +\n  geom_line(size = .5, colour = \"black\", alpha = .75, linetype = 2) +\n  theme_minimal() +\n  ylab(\"SMM (%)\")+\n  xlab(\"Incentive\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) +\n  theme(legend.position = c(.1, .2)) +\n  scale_shape(name = \"Legend\", labels = c(\"Fast Payer\", \"Slow Payer\")) \n\n\n#graph 14\n\n  BurnoutData <- data.frame(c(seq(1,360,1)))\n  BurnoutData[2] <- Burnout(beta1 = -.01, beta2 = -.01, MaxIncen = 25, LoanAge = BurnoutData[,1])\n  colnames(BurnoutData) <- c(\"LoanAge\", \"Burnout\")\n  BurnoutData <- melt(BurnoutData, id = \"LoanAge\")\n\n  ggplot(BurnoutData, aes(x=LoanAge, y = value , linetype = variable)) +\n  geom_line(size = .5, colour = \"black\", alpha = .75, linetype = 2) +\n  geom_point(size = 1, colour = \"black\", alpha = .5) +\n  theme_minimal() +\n  ylab(\"Burnout (%)\")+\n  xlab(\"Loan Age\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) \n\n\n# graph 15 - need to call tune parameters for this\nPrepaymentModelData <- data.frame(c(seq(1,360,1)))\nPrepaymentModelData[2] <- ifelse(PrepaymentModelData[,1]%%12 != 0, PrepaymentModelData[,1]%%12, 12)\nPrepaymentModelData[3] <- rep(0,360)\nPrepaymentModelData[4] <- Prepayment.Model(Turnover.Rate = .08, LoanAge = PrepaymentModelData[,1], Month = PrepaymentModelData[,2], incentive = PrepaymentModelData[,3])\nPrepaymentModelData[5] <- (1-(1-PrepaymentModelData[,4])^12) * 100\ncolnames(PrepaymentModelData) <- c(\"LoanAge\", \"Month\", \"Incentive\", \"SMM\", \"CPR\")\n\nPrepaymentModel <- data.frame(PrepaymentModelData[,1])\nPrepaymentModel[2] <- PrepaymentModelData[,5]\ncolnames(PrepaymentModel) <- c(\"LoanAge\", \"CPR\")\nPrepaymentModel <- melt(PrepaymentModel, id = \"LoanAge\")\n\nggplot(subset(PrepaymentModel, LoanAge <= 120), aes(x=LoanAge, y = value , linetype = variable)) +\n  geom_point(size = 4, colour = \"black\", alpha = .5) +\n  geom_line(size = .3, colour = \"black\", alpha = .75, linetype = 1) +\n  theme_minimal() +\n  ylab(\"CPR (%)\")+\n  xlab(\"Loan Age\") +\n  theme(panel.grid.major = element_line(size = .25, color = \"grey\")) +\n  theme(axis.text = element_text(size = 15)) +\n  theme(axis.title = element_text(size = 20)) \n \n\n#Table to refinance\n\nRefiTable <- data.frame(c(seq(100000, 400000, 50000)))\nRefiTable[2] <- Mortgage.Monthly.Payment(orig.bal = RefiTable[,1], note.rate = 5, term.mos = 360)\nRefiTable[3] <- Mortgage.Monthly.Payment(orig.bal = RefiTable[,1], note.rate = 4.5, term.mos = 360)\nRefiTable[4] <- RefiTable[,2] - RefiTable[,3]\nRefiTable[5] <- rep(2000,7)\nRefiTable[6] <- as.integer(RefiTable[,5]/RefiTable[,4])\n\n\n",
    "created" : 1398218521746.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "127856154",
    "id" : "DBED0E69",
    "lastKnownWriteTime" : 1398303886,
    "path" : "~/Documents/Investing in Mortgage Backed Securities/Tex-1/chapters/Chapter09/R code.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}