begin.cpr = .2 * (Scenarios[i]/100),
end.cpr = 6 * (Scenarios[i]/100),
seasoning.period = 30)@WAL
ALdata[i,3]<- REMICCashFlow(bond.id = "BondLabCMP_Z",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * (Scenarios[i]/100),
end.cpr = 6 * (Scenarios[i]/100),
seasoning.period = 30)@WAL
ALdata[i,4]<- REMICCashFlow(bond.id = "BondLabZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * (Scenarios[i]/100),
end.cpr = 6 * (Scenarios[i]/100),
seasoning.period = 30)@WAL
}
colnames(ALdata) <- c("Scenario", "PAC", "Companion", "Z-bond")
ALdata <- melt(ALdata, id = "Scenario")
ALgraph <- ggplot(ALdata, aes(x = as.factor(Scenario), y = value, fill = variable)) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(name = "", values = cbbPalette, labels = c("PAC", "Companion", "Z-bond")) +
theme_minimal()+
theme(panel.grid.major = element_line(size = .25, color = "grey"))+
ylab("Weighted Avg. Life") +
xlab("PSA Assumption") +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(plot.margin = unit(c(0, .75, 0, 2), "cm")) +
theme(legend.position=c(.87,.85), legend.background = element_rect(fill = "white", colour = "white")) +
theme(legend.key= element_rect(fill="white", colour= "white"))
ALtable <- ggplot(ALdata, aes(x = as.factor(Scenario), y = variable, label = round(value, digits = 2))) +
geom_text(size = 5.5) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank(), panel.grid = element_blank(),
axis.ticks.x = element_blank(), axis.text.x = element_blank(), axis.ticks.y = element_blank(), axis.text.y = element_text(size = rel(1.5))) +
scale_y_discrete(labels = c("PAC", "Companion", "Z-bond"))
Layout <- grid.layout(nrow = 2, ncol = 1,
widths = unit(c(1), c("null", "null")),
heights = unit(c(2, .5), c("null", "null")))
grid.show.layout(Layout)
vplayout <- function(...){
grid.newpage()
pushViewport(viewport(layout = Layout))
}
subplot <- function(x, y) viewport(layout.pos.row = x,
layout.pos.col = y)
mmplot <- function(a, b) {
vplayout()
print(a, vp = subplot(1, 1))
print(b, vp = subplot(2, 1))
}
mmplot(ALgraph, ALtable)
#=========== testing of ggplot
AL.Graph <- gtable(widths = unit(1, "null"), heights = unit(c(2,.5), "null"),
respect = FALSE)
gtable_show_layout(AL.Graph)
AL.Graph <- gtable_add_grob(AL.Graph, ALgraph, 1, 1)
AL.Graph <- gtable_add_grob(AL.Graph, ALtable, 2, 1)
plot(AL.Graph)
#================
Key.Rate.Duration <- cbind(BondLabZ@KeyRateTenor, BondLabZ@KeyRateDuration)
colnames(Key.Rate.Duration) <- c("Tenor", "Duration")
Key.Rate.Duration <- as.data.frame(Key.Rate.Duration)
ggplot(Key.Rate.Duration, aes(x = as.factor(Tenor), fill = as.factor(Tenor), y = Duration)) +
geom_bar(stat = "identity")+
scale_fill_manual(values = cbbPalette, guide = "none") +
theme_minimal()+
theme(panel.grid.major = element_line(size = .25, color = "grey"))+
ylab("Key Rate Duration") +
xlab("Key Rate Tenor (years)") +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20))
# == 19.4 ====================
MBS.OAS.AL <- data.frame(MBS4.OAS@PathWAL)
MBS.OAS.AL <- cbind(MBS.OAS.AL, seq(1: length(MBS.OAS.AL)))
colnames(MBS.OAS.AL) <- c("value", "count")
ggplot(MBS.OAS.AL, aes(x = value )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(0, 15, 1)) +
ylab("Frequency")+
xlab("Path Avg. Life") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# == 19.5 ====================
Z.OAS.AL <- data.frame(BondLabZ_OAS@PathWAL)
Z.OAS.AL <- cbind(Z.OAS.AL, seq(1: length(Z.OAS.AL)))
colnames(Z.OAS.AL) <- c("value", "count")
ggplot(Z.OAS.AL, aes(x = value )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(10, 60, 5)) +
ylab("Frequency")+
xlab("Path Avg. Life") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# == 19.6 ====================
MBS.OAS.Spd <- data.frame(MBS4.OAS@PathSpread)
MBS.OAS.Spd <- cbind(MBS.OAS.Spd, seq(1: length(MBS.OAS.Spd)))
colnames(MBS.OAS.Spd) <- c("value", "count")
ggplot(MBS.OAS.Spd, aes(x = value * 100)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(-1, 3, .5)) +
ylab("Frequency")+
xlab("Path Spread") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# == 19.7 ====================
Z.OAS.Spd <- data.frame(BondLabZ_OAS@PathSpread)
Z.OAS.Spd <- cbind(Z.OAS.Spd, seq(1: length(Z.OAS.Spd)))
colnames(Z.OAS.Spd) <- c("value", "count")
ggplot(Z.OAS.Spd, aes(x = value * 100 )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(-4, 4, .5)) +
ylab("Frequency")+
xlab("Path Spread") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# ===== Zbond Average Life
sum(BondLabZ@TimePeriod * BondLabZ@Principal)/sum(BondLabZ@Principal)
BondLabPAC_Z  <-  REMICAnalytics(bond.id = "BondLabPACZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
method = "ns",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "MODEL",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
require(ggplot2)
require(grid)
require(gridExtra)
require(reshape2)
Palette <- c("#E69F00",
"#56B4E9",
"#CC79A7",
"#009E73",
"#F0E442",
"#D55E00",
"#0072B2",
"#000000")
cbbPalette <- rep(Palette, length.out = 200)
REMIC <- MBS(MBS.id = "BondLabPACZ")
BondLabPAC <-  REMICCashFlow(bond.id = "BondLabPAC1",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 105,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
BondLabCMP <-  REMICCashFlow(bond.id = "BondLabCMP1",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 115,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
BondLabPACZ <-  REMICCashFlow(bond.id = "BondLabPACZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
BondLabPAC_Z  <-  REMICAnalytics(bond.id = "BondLabPACZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
method = "ns",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "MODEL",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
BondLabPAC_Z_OAS <-  REMIC.OAS(bond.id = "BondLabPACZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
tranche.price = 108,
collateral.price = 100,
sigma = 0.015,
paths = 200)
BondLabCMP_Z_CF <-  REMICCashFlow(bond.id = "BondLabCMP_Z",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 103,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
BondLabCMP_Z  <-  REMICAnalytics(bond.id = "BondLabCMP_Z",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
method = "ns",
collateral.price = 105.75,
tranche.price = 103,
PrepaymentAssumption = "MODEL",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
BondLabCMP_Z_OAS <-  REMIC.OAS(bond.id = "BondLabCMP_Z",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 103,
sigma = 0.015,
paths = 200)
BondLabZ_CF <-  REMICCashFlow(bond.id = "BondLabZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 101,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
set.seed(300)
BondLabZ  <-  REMICAnalytics(bond.id = "BondLabZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
method = "ns",
collateral.price = 105.75,
tranche.price = 101,
PrepaymentAssumption = "MODEL",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
set.seed(300)
BondLabZ_OAS <-  REMIC.OAS(bond.id = "BondLabZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
tranche.price = 100,
collateral.price = 101,
sigma = 0.015,
paths = 200)
set.seed(300)
MBS4.OAS <- PassThroughOAS(bond.id = "bondlabMBS4",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
original.bal = 100000,
price = 105.75,
short.rate = 0.0016,
sigma = 0.015,
paths = 200,
PrepaymentAssumption = "MODEL")
CompCF <- data.frame(cbind(BondLabCMP@Period, BondLabCMP@Principal, BondLabCMP_Z_CF@Principal))
colnames(CompCF) <- c("Period", "Companion", "Companion w/ Z")
CompCF <- melt(CompCF, id = "Period")
ggplot(CompCF, aes(x= Period, y = value/1000, colour = variable, fill = variable)) +
geom_area(alpha = .8, color = "white")+
scale_fill_manual(name = "", labels = c("Companion", "Companion with Z-bond"), values = cbbPalette) +
xlab("Time Period (mos.)") +
ylab("Principal Payment (,000s)") +
theme_minimal()+
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 20)) +
theme(axis.title = element_text(size = 15)) +
theme(axis.text.y = element_text(angle = 90, size = 15)) +
theme(legend.position=c(.68,.9), legend.background = element_rect(fill = "white", colour = "white")) +
theme(legend.key= element_rect(fill="white", colour= "white"))
Scenarios <- c(50, 100, 150, 200, 250, 300, 350)
ALdata <- data.frame(array(data = 0 , c(7,4)))
ALdata[,1] <- Scenarios
for(i in 1:length(Scenarios)){
ALdata[i,2]<- REMICCashFlow(bond.id = "BondLabPACZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * (Scenarios[i]/100),
end.cpr = 6 * (Scenarios[i]/100),
seasoning.period = 30)@WAL
ALdata[i,3]<- REMICCashFlow(bond.id = "BondLabCMP_Z",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * (Scenarios[i]/100),
end.cpr = 6 * (Scenarios[i]/100),
seasoning.period = 30)@WAL
ALdata[i,4]<- REMICCashFlow(bond.id = "BondLabZ",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 108,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * (Scenarios[i]/100),
end.cpr = 6 * (Scenarios[i]/100),
seasoning.period = 30)@WAL
}
colnames(ALdata) <- c("Scenario", "PAC", "Companion", "Z-bond")
ALdata <- melt(ALdata, id = "Scenario")
ALgraph <- ggplot(ALdata, aes(x = as.factor(Scenario), y = value, fill = variable)) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(name = "", values = cbbPalette, labels = c("PAC", "Companion", "Z-bond")) +
theme_minimal()+
theme(panel.grid.major = element_line(size = .25, color = "grey"))+
ylab("Weighted Avg. Life") +
xlab("PSA Assumption") +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(plot.margin = unit(c(0, .75, 0, 2), "cm")) +
theme(legend.position=c(.87,.85), legend.background = element_rect(fill = "white", colour = "white")) +
theme(legend.key= element_rect(fill="white", colour= "white"))
ALtable <- ggplot(ALdata, aes(x = as.factor(Scenario), y = variable, label = round(value, digits = 2))) +
geom_text(size = 5.5) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank(), panel.grid = element_blank(),
axis.ticks.x = element_blank(), axis.text.x = element_blank(), axis.ticks.y = element_blank(), axis.text.y = element_text(size = rel(1.5))) +
scale_y_discrete(labels = c("PAC", "Companion", "Z-bond"))
Layout <- grid.layout(nrow = 2, ncol = 1,
widths = unit(c(1), c("null", "null")),
heights = unit(c(2, .5), c("null", "null")))
grid.show.layout(Layout)
vplayout <- function(...){
grid.newpage()
pushViewport(viewport(layout = Layout))
}
subplot <- function(x, y) viewport(layout.pos.row = x,
layout.pos.col = y)
mmplot <- function(a, b) {
vplayout()
print(a, vp = subplot(1, 1))
print(b, vp = subplot(2, 1))
}
mmplot(ALgraph, ALtable)
#=========== testing of ggplot
AL.Graph <- gtable(widths = unit(1, "null"), heights = unit(c(2,.5), "null"),
respect = FALSE)
gtable_show_layout(AL.Graph)
AL.Graph <- gtable_add_grob(AL.Graph, ALgraph, 1, 1)
AL.Graph <- gtable_add_grob(AL.Graph, ALtable, 2, 1)
plot(AL.Graph)
#================
Key.Rate.Duration <- cbind(BondLabZ@KeyRateTenor, BondLabZ@KeyRateDuration)
colnames(Key.Rate.Duration) <- c("Tenor", "Duration")
Key.Rate.Duration <- as.data.frame(Key.Rate.Duration)
ggplot(Key.Rate.Duration, aes(x = as.factor(Tenor), fill = as.factor(Tenor), y = Duration)) +
geom_bar(stat = "identity")+
scale_fill_manual(values = cbbPalette, guide = "none") +
theme_minimal()+
theme(panel.grid.major = element_line(size = .25, color = "grey"))+
ylab("Key Rate Duration") +
xlab("Key Rate Tenor (years)") +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20))
# == 19.4 ====================
MBS.OAS.AL <- data.frame(MBS4.OAS@PathWAL)
MBS.OAS.AL <- cbind(MBS.OAS.AL, seq(1: length(MBS.OAS.AL)))
colnames(MBS.OAS.AL) <- c("value", "count")
ggplot(MBS.OAS.AL, aes(x = value )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(0, 15, 1)) +
ylab("Frequency")+
xlab("Path Avg. Life") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# == 19.5 ====================
Z.OAS.AL <- data.frame(BondLabZ_OAS@PathWAL)
Z.OAS.AL <- cbind(Z.OAS.AL, seq(1: length(Z.OAS.AL)))
colnames(Z.OAS.AL) <- c("value", "count")
ggplot(Z.OAS.AL, aes(x = value )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(10, 60, 5)) +
ylab("Frequency")+
xlab("Path Avg. Life") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# == 19.6 ====================
MBS.OAS.Spd <- data.frame(MBS4.OAS@PathSpread)
MBS.OAS.Spd <- cbind(MBS.OAS.Spd, seq(1: length(MBS.OAS.Spd)))
colnames(MBS.OAS.Spd) <- c("value", "count")
ggplot(MBS.OAS.Spd, aes(x = value * 100)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(-1, 3, .5)) +
ylab("Frequency")+
xlab("Path Spread") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# == 19.7 ====================
Z.OAS.Spd <- data.frame(BondLabZ_OAS@PathSpread)
Z.OAS.Spd <- cbind(Z.OAS.Spd, seq(1: length(Z.OAS.Spd)))
colnames(Z.OAS.Spd) <- c("value", "count")
ggplot(Z.OAS.Spd, aes(x = value * 100 )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(-4, 4, .5)) +
ylab("Frequency")+
xlab("Path Spread") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# ===== Zbond Average Life
sum(BondLabZ@TimePeriod * BondLabZ@Principal)/sum(BondLabZ@Principal)
BondLabCMP <-  REMICCashFlow(bond.id = "BondLabCMP1",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
collateral.price = 105.75,
tranche.price = 103,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
sum(BondLabZ@KeyRate[1:5])
sum(BondLabZ@KeyRateDuration[1:5])
BondLabZ@KeyRateDuration
sum(BondLabZ@KeyRateDuration[6:8])
sum(BondLabZ@KeyRateDuration[8:11])
20.2/16.5
500 * 7
500 * 40
(500 * 40) / 60
(500 * 40) / 60 /60
(2500 * 40) / 60 /60
(2500 * 20) / 60 /60
(500 * 20) / 60 /60
((500 * 20) / 60 /60) * 10
((500 * 20) / 60 /60) * 5
library(BondLab)
cite(termstrc)
citation(termstrc)
library("termstrc", lib.loc="/Library/Frameworks/R.framework/Versions/3.1/Resources/library")
citation(termstrc)
citation
citation(termstrc)
termstrc
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
getMethods(DollarRollAnalytics)
DollarRollAnalytics
getAnywhere(DollarRoll)
getAnywhere(DollarRollAnalytics)
library(BondLab)
library(BondLab)
library(BondLab)
library(BondLab)
5000 * 100
5000 * 1000
library(BondLab)
0.02 8 30
0.02 * 30
library("BondLab", lib.loc="/Library/Frameworks/R.framework/Versions/3.1/Resources/library")
library(BondLab)
library(BondLab)
3000 * 150000
2000 * 80000
1000 * 80000
1000 * 60000
2000 * 1000
2000 * 1000 *12
2000 * 1000 *12 *.60
100 * (2/1600)
100 * (2/1600) * 100000000000
100 * (2/1600) * 100000000000
100 * (1/1600) * 100000000000
