# ================ This makes the histograms for 12.18 through 12.19 ===================
# Run the paths above at 5,000 paths
MBS4.Data <- data.frame(MBS4.OAS@PriceDist)
MBS4.Data <- cbind(MBS4.Data, seq(1: length(MBS4.Data)))
colnames(MBS4.Data) <- c("value", "count")
set.seed(300)
MBS4.OAS <- PassThroughOAS(bond.id = "bondlabMBS4",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
original.bal = 100000,
price = 105.75,
short.rate = 0.0016,
sigma = 0.015,
paths = 5000,
PrepaymentAssumption = "MODEL")
MBS4.Data <- data.frame(MBS4.OAS@PriceDist)
MBS4.Data <- cbind(MBS4.Data, seq(1: length(MBS4.Data)))
colnames(MBS4.Data) <- c("value", "count")
ggplot(MBS4.Data, aes(x = value )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(80,120, 5)) +
ylab("Frequency")+
xlab("Path Price") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
mean(MBS4.OAS@PriceDist)
median(MBS4.OAS@PriceDist)
mfv(round(MBS4.OAS@PriceDist,2))[1]
sd(MBS4.OAS@PriceDist)
set.seed(300)
MBS55.OAS <- PassThroughOAS(bond.id = "bondlabMBS55",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
original.bal = 100000,
price = 107.50,
short.rate = 0.0016,
sigma = 0.015,
paths = 5000,
PrepaymentAssumption = "MODEL")
MBS55.Data <- data.frame(MBS55.OAS@PriceDist)
MBS55.Data <- cbind(MBS55.Data, seq(1: length(MBS55.Data)))
colnames(MBS55.Data) <- c("value", "count")
mean(MBS55.OAS@PriceDist)
median(MBS55.OAS@PriceDist)
mlv(round(MBS55.OAS@PriceDist,2), method = "discrete")
mfv(round(MBS55.OAS@PriceDist,2))[1]
sd(MBS55.OAS@PriceDist)
ggplot(MBS55.Data, aes(x = value)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
ylab("Frequency")+
xlab("Path Price") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# ================ This makes the histograms for 12.20 through 12.21 ===================
# Run the paths above at 5,000 paths
MBS4.Data <- data.frame(MBS4.OAS@PathSpread)
MBS4.Data <- cbind(MBS4.Data, seq(1: length(MBS4.Data)))
colnames(MBS4.Data) <- c("value", "count")
ggplot(MBS4.Data, aes(x = value * 100)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(-3,3, .5)) +
ylab("Frequency")+
xlab("Path Spread") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
mean(MBS4.OAS@PathSpread)
median(MBS4.OAS@PathSpread)
mfv(round(MBS4.OAS@PathSpread,2))[1]
sd(MBS4.OAS@PathSpread)
MBS55.Data <- data.frame(MBS55.OAS@PathSpread)
MBS55.Data <- cbind(MBS55.Data, seq(1: length(MBS55.Data)))
colnames(MBS55.Data) <- c("value", "count")
ggplot(MBS55.Data, aes(x = value * 100)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
scale_x_continuous(breaks = seq(-3,3, .5)) +
ylab("Frequency")+
xlab("Path Spread") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
mean(MBS55.OAS@PathSpread)
median(MBS55.OAS@PathSpread)
mlv(round(MBS55.OAS@PathSpread,2), method = "discrete")
mfv(round(MBS55.OAS@PathSpread,2))[1]
sd(MBS55.OAS@PathSpread)
# ================== End of Code for charts 12.20 to 12.21 ================================
# next make charts 12.22 to 12.23 for average life distribtion analysis
# Run the paths above at 5,000 paths
MBS4.Data <- data.frame(MBS4.OAS@PathWAL)
MBS4.Data <- cbind(MBS4.Data, seq(1: length(MBS4.Data)))
colnames(MBS4.Data) <- c("value", "count")
ggplot(MBS4.Data, aes(x = value)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
ylab("Frequency")+
xlab("Path Weighted Average Life (yrs.)") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
MBS55.Data <- data.frame(MBS55.OAS@PathWAL)
MBS55.Data <- cbind(MBS55.Data, seq(1: length(MBS55.Data)))
colnames(MBS55.Data) <- c("value", "count")
ggplot(MBS55.Data, aes(x = value )) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
ylab("Frequency")+
xlab("Path Weighted Average Life (yrs.)") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
mean(MBS4.OAS@PathWAL)
min(MBS4.OAS@PathWAL)
max(MBS4.OAS@PathWAL)
sd(MBS4.OAS@PathWAL)
mean(MBS55.OAS@PathWAL)
min(MBS55.OAS@PathWAL)
max(MBS55.OAS@PathWAL)
sd(MBS55.OAS@PathWAL)
# ============================ End of the code to make chapter 12.22 to 12.23 ================
# next make charts 12.24 to 12.25 for average life distribtion analysis
# Run the paths above at 5,000 paths
MBS4.Data <- data.frame(MBS4.OAS@PathYTM)
MBS4.Data <- cbind(MBS4.Data, seq(1: length(MBS4.Data)))
colnames(MBS4.Data) <- c("value", "count")
ggplot(MBS4.Data, aes(x = value * 100)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
ylab("Frequency")+
xlab("Path Yield to Maturity") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
MBS55.Data <- data.frame(MBS55.OAS@PathYTM)
MBS55.Data <- cbind(MBS55.Data, seq(1: length(MBS55.Data)))
colnames(MBS55.Data) <- c("value", "count")
ggplot(MBS55.Data, aes(x = value * 100)) +
geom_histogram(colour = "lightgrey", fill = "#0072B2") +
theme_minimal() +
ylab("Frequency")+
xlab("Path Yield to Maturity") +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
mean(MBS4.OAS@PathYTM)
min(MBS4.OAS@PathYTM)
max(MBS4.OAS@PathYTM)
sd(MBS4.OAS@PathYTM)
mean(MBS55.OAS@PathYTM)
min(MBS55.OAS@PathYTM)
max(MBS55.OAS@PathYTM)
sd(MBS55.OAS@PathYTM)
# ================ Key Rate Duration (Mortgage Term Structure) =======
set.seed(300)
MBS4.OAS <- PassThroughOAS(bond.id = "bondlabMBS4", trade.date = "01-10-2013", settlement.date = "01-13-2013", original.bal = 100000,
price = 105.75, short.rate = 0.0016, sigma = 0.015, paths = 200, PrepaymentAssumption = "MODEL")
# ================ Key Rate Duration (Mortgage Term Structure) =======
set.seed(300)
MBS55.OAS.2 <- PassThroughOAS(bond.id = "bondlabMBS55", trade.date = "01-10-2013", settlement.date = "01-13-2013", original.bal = 100000,
price = 107.5, short.rate = 0.0016, sigma = 0.015, paths = 200, PrepaymentAssumption = "MODEL")
require(scales)
require(reshape2)
require(ggplot2)
cbbPalette <- c("#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7",
"#000000",
"#E69F00",
"#56B4E9",
"#009E73")
# CIR simulation of one period spot rates
# CIR at zero volatility is the forward curve
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016,
kappa = .1,
theta = .052,
T = 30,
step = 1/12,
sigma = 0.015,
N = 10)
require(scales)
require(reshape2)
require(ggplot2)
cbbPalette <- c("#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7",
"#000000",
"#E69F00",
"#56B4E9",
"#009E73")
# CIR simulation of one period spot rates
# CIR at zero volatility is the forward curve
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016,
kappa = .1,
theta = .052,
T = 30,
step = 1/12,
sigma = 0.015,
N = 10)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation graph 12.1
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
# Figure  12.1
ggplot(subset(sim, Period <= 360), aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 20), breaks = seq(0,20, 2))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
#kappa sensitive of the model 12.2
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016, kappa = .1, theta = .052, T = 30, step = 1/12, sigma = 0.015, N = 10)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 16), breaks = seq(0,16, 2))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
#kappa sensitivity of the model 12.3
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016, kappa = .7, theta = .052, T = 30, step = 1/12, sigma = 0.015, N = 10)
#matplot(Time, simulation[,1:10] * 100, type = "l")
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
#  simulation <- cbind(Time, simulation)
colnames(simulation) <- c("path1", "path2", "path3", "path4", "path5", "path6", "path7", "path8", "path9", "path10")
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 16), breaks = seq(0,16, 2))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
#kappa sensitivity of the model 12.4
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016,
kappa = .7,
theta = .02,
T = 30,
step = 1/12,
sigma = 0.015,
N = 10)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
#  simulation <- cbind(Time, simulation)
colnames(simulation) <- c("path1", "path2", "path3", "path4", "path5", "path6", "path7", "path8", "path9", "path10")
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 6), breaks = seq(0,6, 1))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016,
kappa = .7,
theta = .1,
T = 30,
step = 1/12,
sigma = 0.015,
N = 10)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
#  simulation <- cbind(Time, simulation)
#colnames(simulation) <- c("path1", "path2", "path3", "path4", "path5", "path6", "path7", "path8", "path9", "path10")
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 16), breaks = seq(0,16, 1))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
#kappa sensitivity of the model 12.6
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016,
kappa = .1,
theta = .052,
T = 30,
step = 1/12,
sigma = 0.015,
N = 10)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
#  simulation <- cbind(Time, simulation)
colnames(simulation) <- c(rep((paste("path", seq(1:10)))))
#colnames(simulation) <- c("path1", "path2", "path3", "path4", "path5", "path6", "path7", "path8", "path9", "path10")
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 20), breaks = seq(0,20, 2))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
#kappa sensitivity of the model 12.7
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016,
kappa = .1,
theta = .052,
T = 30,
step = 1/12,
sigma = 0.00,
N = 1)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
#  simulation <- cbind(Time, simulation)
#colnames(simulation) <- c("path1", "path2", "path3", "path4", "path5", "path6", "path7", "path8", "path9", "path10")
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
# Figure 12.7
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
scale_colour_manual(values = cbbPalette) +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_y_continuous(limits = c(0, 6), breaks = seq(0,6, 1))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
# Figure 12.9
set.seed(10000)
simulation <- CIRSim(shortrate = 0.0016, kappa = 0.109, theta = .0442, T = 30, step = 1/12, sigma = 0.015, N = 1)
# Plot interest rate paths
Time <-seq(0, 30, 1/12)
# Simulation
sim <- melt(simulation)
colnames(sim) <- c("Period", "Variable", "Value" )
ggplot(sim, aes(x = Period, y = Value * 100, colour = Variable, linetype = Variable)) +
geom_line(size = 1) +
theme_minimal() +
labs(colour = "Legend", linetype = "Legend", x = "Tenor (Mos.)", y = "Spot Rate (%)") +
scale_colour_manual(values = cbbPalette) +
scale_y_continuous(limits = c(0, 9), breaks = seq(0,9, .5))  +
scale_x_continuous(limits = c(0, 360), breaks = seq(0, 360, 36)) +
theme(panel.grid.major = element_line(size = .25, color = "grey")) +
theme(axis.text = element_text(size = 15)) +
theme(axis.title = element_text(size = 20)) +
theme(legend.position = "none")
set.seed(300)
MBS4.OAS <- PassThroughOAS(bond.id = "bondlabMBS4",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
original.bal = 100000,
price = 105.75,
short.rate = 0.0016,
sigma = 0.015,
paths = 125,
PrepaymentAssumption = "MODEL")
set.seed(300)
MBS4.OAS <- PassThroughOAS(bond.id = "bondlabMBS4",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
original.bal = 100000,
price = 105.75,
#short.rate = 0.0016,
sigma = 0.015,
paths = 125,
PrepaymentAssumption = "MODEL")
set.seed(300)
MBS4.OAS <- PassThroughOAS(bond.id = "bondlabMBS4",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
original.bal = 100000,
price = 105.75,
short.rate = 0.0016,
sigma = 0.015,
paths = 5000,
PrepaymentAssumption = "MODEL")
REMICSEQ3  <-  REMICAnalytics(bond.id = "BondLabSEQ3",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
method = "ns",
collateral.price = 105.75,
tranche.price = 100,
PrepaymentAssumption = "PPC",
begin.cpr = .2 * 1.25,
end.cpr = 6 * 1.25,
seasoning.period = 30)
set.seed(300)
REMICSEQ3OAS <- REMIC.OAS(bond.id = "BondLabSEQ3",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
tranche.price = 100,
collateral.price = 100,
short.rate = 0.0016,
sigma = 0.015,
paths = 200)
set.seed(300)
IO.OAS <- REMIC.OAS(bond.id = "BondLabSMBSIO",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
tranche.price = 24,
collateral.price = 105.75,
sigma = .237/sqrt(250),
paths  = 200)
set.seed(300)
PO.OAS <- REMIC.OAS(bond.id = "BondLabSMBSPO",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
tranche.price = 81.75,
collateral.price = 105.75,
sigma = .237/sqrt(250),
paths  = 200)
detach("package:methods", unload=TRUE)
library("methods", lib.loc="/Library/Frameworks/R.framework/Versions/3.1/Resources/library")
detach("package:datasets", unload=TRUE)
detach("package:graphics", unload=TRUE)
detach("package:grDevices", unload=TRUE)
detach("package:stats", unload=TRUE)
library("stats", lib.loc="/Library/Frameworks/R.framework/Versions/3.1/Resources/library")
detach("package:utils", unload=TRUE)
library("utils", lib.loc="/Library/Frameworks/R.framework/Versions/3.1/Resources/library")
library(BondLab)
REMICAnalytics
REMICAnalytics()
library(BondLab)
REMICAnalytics()
REMICAnalytics
library(BondLab)
REMICAnalytics
library(BondLab)
REMICAnalytics
library(BondLab)
REMICAanlytic
REMICAanlytics
library(BondLab)
REMICAnalytics
REMICIOAnalysis <-  REMICAnalytics(bond.id = "BondLabSMBSIO",
trade.date = "01-10-2013",
settlement.date = "01-13-2013",
method = "ns",
collateral.price = 105.75,
tranche.price = 24,
PrepaymentAssumption = "MODEL",
CPR = 8)
116 * (1/3200)
116 * (1/3200) * 1000000000
116 * (2/3200) * 1000000000
116 * (2/3200) * 1000000000 * 12
116 * (1/3200) * 1000000000 * 12
116 * (1/3200) * 1000000000 * 12 * 10
116 * (1/3200) * 1000000000 * 12 * 10 * .1 * .3
