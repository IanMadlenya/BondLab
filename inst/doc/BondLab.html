<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Glenn M. Schultz, CFA" />

<meta name="date" content="2017-06-04" />

<title>Bond Lab®</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Bond Lab®</h1>
<h4 class="author"><em>Glenn M. Schultz, CFA</em></h4>
<h4 class="date"><em>2017-06-04</em></h4>



<div id="preface" class="section level1">
<h1>Preface</h1>
<p>Bond Lab® is an R package for the analysis of fixed income securities. The analytical engines are modular in nature thereby allowing the user to create a customized fixed income analytical output. Bond Lab® is written in the S4 language and introduces a number of new classes.</p>
<p>Bond Lab® classes are classified as those that support bonds (standard fixed income), mortgage- and asset-backed securities, analytic output, term structure. BondLab® uses the following R packages:<br />
* termstrc<br />
* lubridate<br />
* methods<br />
* optimx<br />
* RCurl<br />
* splines<br />
* knitr<br />
* devtools<br />
* testthat<br />
* rmarkdown</p>
<div id="the-bond-lab-valuation-framework" class="section level2">
<h2>The Bond Lab® Valuation Framework</h2>
<p>The Bond Lab® valuation framework combines both linear and non-linear term structure assumptions into a holistic valuation framework. Bond cashflows are viewed as bundle of zero coupon cashflows which are discounted along the spot rate curve. The value or price of a bond is sum of the individual valuation of each zero coupon cashflow. The timing and magnitude of the cahflows determine the relative richness or cheapness of each cashflow.</p>
<ul>
<li><p>The cheap cashflows are those whose present value along the spot curve are greater than the yield to maturity (a linear term structure assumption) pricing of each cashflow.</p></li>
<li><p>The rich cashflows are those whose present value along the sopt rate curve are less than the yield to maturity assumption pricing of each cashflow.</p></li>
</ul>
<blockquote>
<p>the spread to the spot rate curve is referred to in the fixed income markets as the <strong>Zero Volatility Spread</strong>. The zero volatility spread (ZV spread) is the spread which equates the present value of a bond’s cash flows along the spot rate curve to its yield to maturity price. The zero volatility spread is the corner stone upon which the valuation framework is built, linking the linear and non-linear term structure pricing assumptions.</p>
</blockquote>
<p><strong>From the <em>valuation framework</em> we can deduce the following:</strong></p>
<table>
<colgroup>
<col width="50%"></col>
<col width="50%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Relationship</th>
<th>Valuation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Zero Volatility Spread &lt; Nominal Spread</td>
<td>Rich cash flows outweigh cheap cash flows</td>
</tr>
<tr class="even">
<td>Zero Volatility Spread = Nominal Spread</td>
<td>Rich and cheap cash flows are balanced</td>
</tr>
<tr class="odd">
<td>Zero Volatility Spread &gt; Nominal Spread</td>
<td>Cheap cash flows outweigh rich cash flows</td>
</tr>
</tbody>
</table>
</div>
<div id="bond-lab-design-philosphy" class="section level2">
<h2>Bond Lab® Design Philosphy</h2>
<p>Bond Lab® is designed to be modular. All classes are exposed to the user thereby allowing the user to create new class from existing classes (super class) or extend the classes as the user sees fit. Thus, the user is free to combine these classes into a new class consiting of superclasses to fit her analytics needs or extend classes to incorporate additional analytic information. The Bond Lab® classes are outlined below:</p>
</div>
</div>
<div id="bond-lab-classes" class="section level1">
<h1>Bond Lab® Classes</h1>
<div id="conversion-classes" class="section level2">
<h2>Conversion Classes</h2>
<p>Conversion classes take a value or string and convert the object to numeric, basis, or string.</p>
<div id="pricetypes" class="section level3">
<h3>PriceTypes</h3>
<pre><code>The PriceTypes class represents price as passed to functions. Price is passed
to functions as a character.  The PriceTypes class converts the character value
to numeric and string values. It contains Price (numeric), Price32nds(string),
PriceBasis (numeric), and PriceDecimalString (character).  Price are be passed
to BondLab® functions as characters in either decimal (.) or 32nds (-) format.</code></pre>
</div>
<div id="yieldtypes" class="section level3">
<h3>YieldTypes</h3>
<pre><code>The YieldTypes class represents yield to maturity as passed from function.
Yield to maturity is passed to the function in numeric decimal form (3.0).
The YieldTypes class converts teh numeric decimal value to a basis value 
0.30 and a character string.</code></pre>
</div>
<div id="coupontypes" class="section level3">
<h3>CouponTypes</h3>
<pre><code>The CouponTypes class represents the bond coupon passed to a function.  Coupon
is passed to function in numeric decimal form (5.5).  The CouponTypes class 
converts the numeric decimal value to a basis 0.55 and character string</code></pre>
</div>
<div id="gfeetypes" class="section level3">
<h3>GFeeTypes</h3>
<pre><code>The GFeeTypes class represents the guarantee fee, if any, passed to the cashflow
engine.  GFee is passed to the function in numeric decimal form (0.35).
The GFeeTypes converts the numeric decimal value to a basis 0.0035 and character
string.</code></pre>
</div>
<div id="gwactypes" class="section level3">
<h3>GWacTypes</h3>
<pre><code>The GWacTypes class represents the borrower Gross WAC passed to the cashflow
engine.  GWac is passed to the function in numeric decimal form (4.00).
The GWacTypes converts the numeric decimal value to a basis 0.04 and character
string.</code></pre>
</div>
<div id="servicingfeetypes" class="section level3">
<h3>ServicingFeeTypes</h3>
<pre><code>The ServicingFeeTypes class represents the servicing fee passed to the cashflow
engine.  Servicing fee is passed to the function in numeric decimal form (0.30).
The ServicingFeeTypes converts the numeric decimal value to a basis 0.0030 
and character string.</code></pre>
</div>
</div>
<div id="price-term-structure-and-scenario-classes" class="section level2">
<h2>Price, Term Structure, and Scenario classes</h2>
<p>These classes contain the pricing and term structure classes need to price and evlauation the relative richness or cheapness of a bond or mortgage backed security</p>
<div id="termstructure" class="section level3">
<h3>TermStructure</h3>
<pre><code>The TermStructure class represents the term structure of interest rates.  The 
class contains forward rates, spot rates, two year forward, ten year forward.
The constructuctor function TermStrucuture is a wrapper around the package 
termstruc.</code></pre>
</div>
<div id="curvespreads" class="section level3">
<h3>CurveSpreads</h3>
<pre><code>The CurvesSpreads class represents curve spreads.  It contains benchmark, 
spread to benchmark, spread to curve, zero volatility spread.</code></pre>
</div>
<div id="scenario" class="section level3">
<h3>Scenario</h3>
<pre><code>The scenario class represents interest rates used in total return scenario 
analysis.  The user may define and scenario applied to either the coupon curve
or the spot rate curve.  spot rate curve scenarios are designated with a trailing
(s).</code></pre>
</div>
</div>
<div id="bond-classes" class="section level2">
<h2>Bond Classes</h2>
<p>Generally, speaking these classes pertain to a bond which pays a period coupon monthly, quarterly, semi-annually, or annually. The bond may be callable, putable, or have a sinking-fund schedule.</p>
<div id="bonddetails" class="section level3">
<h3>BondDetails</h3>
<pre><code>The BondDetails class represents the cusip detail of a standard bond.  It
includes all the relevant detail to analyze a standard fixed income
security.  Call, Put, and Sinking Fund schedules are not yet implemented. </code></pre>
</div>
<div id="bondcashflows" class="section level3">
<h3>BondCashFlows</h3>
<pre><code>The BondCashFlows class holds all the relevant detail regarding a bond's
cashflow characteristics including: yield-to-maturity, weighted average
life, modified duration, convexity, and bond cashflows coupon payments
and principal payment(s), and total cash flow.</code></pre>
</div>
<div id="bondtermstructure" class="section level3">
<h3>BondTermStructure</h3>
<pre><code>The BondTermStructure class represents the key rate duration and key rate
convexity of bond.</code></pre>
</div>
<div id="bondanalytics" class="section level3">
<h3>BondAnalytics</h3>
<pre><code>The BondAnalytics class is a subclass of BondTermStructure, BondDetails,
BondCashFlows, and TermStructure.  The BondAnalytics class represents the
measures which define the value of and a bond and the risk measures of a
bond.  It is an example of creating a superclass from existing classes.</code></pre>
</div>
<div id="bondreturn" class="section level3">
<h3>BondReturn</h3>
<pre><code>The BondReturn class represents the total return of a bond.  The BondReturn
class contains the coupon income, principal recieved, reinvestment income
horizon balance, horizon price, horizon return, horizon months.  Note:
currently under construction.</code></pre>
</div>
<div id="bondscenario" class="section level3">
<h3>BondScenario</h3>
<pre><code>The BondScenario class represents the bond total return scenario analysis.  
The superclasses of which are BondReturn, BondCashFlows, BondTermStructure, 
and CurveSpreads.  Note: currently under construction.</code></pre>
</div>
</div>
<div id="mortgage-classes" class="section level2">
<h2>Mortgage Classes</h2>
<p>Mortgage class pertain to both mortgage pass-through MBS and REMICs. Mortgage backed securities pay both principal and interest on a monthly basis, often with a delay, based on the pool’s underlying borrowers’ prepayment rates.</p>
<div id="mbsdetails" class="section level3">
<h3>MBSDetails</h3>
<pre><code>The MBSDetails class represents the cusip detail of a mortgage backed 
security.  It includes all the relevant detail needed to determine the 
cashflow and analyze a mortgage pass-through MBS.  The MBSDetails also
includes reference to the prepayment model tuning file and is the primary
means by which a prepayment model is assigned to a MBS cusip.</code></pre>
</div>
<div id="mortgagecashflow" class="section level3">
<h3>MortgageCashFlow</h3>
<pre><code>The MortgageCashFlow class holds the cashflow deatil of a mortgage-backed 
security including: yield to maturity, modified duration and convexity,
SMM, MDR, severity, scheduled interest, scheduled principal, 
prepaid principal, etc.  The MortgageCashFlow class is used to cashflow a
pass-through MBS security.</code></pre>
</div>
<div id="mortgagetermstructure" class="section level3">
<h3>MortgageTermStructure</h3>
<pre><code>The MortgageTermStructure class represents the key rate duration and key
rate convexity of a mortgage backed security.</code></pre>
</div>
<div id="mortgageeffectivemeasures" class="section level3">
<h3>MortgageEffectiveMeasures</h3>
<pre><code>The MortgageEffectiveMeasures class represents effective duration and 
convexity measures.</code></pre>
</div>
<div id="mortgagereturn" class="section level3">
<h3>MortgageReturn</h3>
<pre><code>The MortgageReturn class represents the total return of a mortgage backed
security.  The MortgageReturn class contains the coupon income, scheduled 
principal received, prepaid principal received, reinvestment income, 
horizon current balance, horizon price, horizon return, and horizon months.</code></pre>
</div>
<div id="mortgagescenario" class="section level3">
<h3>MortgageScenario</h3>
<pre><code>The MortgageScenario class represents the mortgage total return analysis. It
is a superclass consisting of the classes TermStructure, PrepaymentAssumption
MortgageCashFlow, MortgageTermStructure, MortgageReturn, ModelToCPR,
CurveSpreads, Scenario.</code></pre>
</div>
<div id="mortgagescenarioset" class="section level3">
<h3>MortgageScenarioSet</h3>
<pre><code>The MortgageScenarioSet class is a list of scenarios which can be used to 
batch calculate MortgageScenario.</code></pre>
</div>
<div id="mortgageoas" class="section level3">
<h3>MortgageOAS</h3>
<pre><code>The MortgageOAS class represents the results of a mortgage OAS analysis. It
is currently defined by slots but plans are to make MortgageOAS a superclass
containing EffectiveMeasures, MortgageTermStructure</code></pre>
</div>
</div>
<div id="prepayment-model-classes" class="section level2">
<h2>Prepayment Model Classes</h2>
<p>The prepayment model classes support the prepayment model used in Bond Lab®.<br />
The Bond Lab® prepayment model is non-parametric in the sense that the model makes no assumption as to the underlying distributional properties of mortgage prepayment rates.</p>
<div id="prepaymentassumption" class="section level3">
<h3>PrepaymentAssumption</h3>
<pre><code>The PrepaymentAssumption class represents the output of the prepayment model,
Prospectus Prepayment Curve (PPC) and CPR.  The class is used to pass 
prepayment assumtptions to mortgage casflow.</code></pre>
</div>
</div>
<div id="prepaymentmodeltune" class="section level2">
<h2>PrepaymentModelTune</h2>
<pre><code>The PrepaymentModelTune class represents the tuning parameters of the 
BondLab prepayment model.  The use of a tuning class allows the user to 
create custom prepayment models for different mortgage product types.
The user may extend the class to add additional model tuning parameters
in the event that PrepaymentModelFunctions slots are extended.</code></pre>
<div id="prepaymentmodelfunctions" class="section level3">
<h3>PrepaymentModelFunctions</h3>
<pre><code>The PrepaymentModelFunctions class represents functions used in the 
construction of a mortgage prepayment model.  The user may add additional
slots to the class to extend the prepayment model.</code></pre>
</div>
</div>
</div>
<div id="anatomy-of-a-bond-lab-call" class="section level1">
<h1>Anatomy of a Bond Lab® Call</h1>
<p>Bond Lab® is designed to be modular in nature. The classes outlined above are passed thereby providing input required for the next step in the analysis. The design is intened to allow users to create bespoke analytic functions addressing the user’s unique question or analytic framework. Through inheritance users can create new superclasses from the subclasses outlined above. The anatomy of a Bond Lab call for MBS return analysis is outlined below</p>
<p>First query the database for available cusip data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  MBSData &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="kw">SQLite</span>(), <span class="dt">dbname=</span><span class="kw">paste0</span>(<span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&quot;BondLab&quot;</span>), <span class="st">&quot;/BondData/MBSData&quot;</span>))
  <span class="kw">dbGetQuery</span>(MBSData,
             <span class="st">'Select Cusip</span>
<span class="st">             ,Coupon</span>
<span class="st">             ,AmortizationTerm</span>
<span class="st">             ,price </span>
<span class="st">             from MBS'</span>)</code></pre></div>
<pre><code>##       Cusip Coupon AmortizationTerm    price
## 1 31283HY40    2.5               30    96-29
## 2 31283HY41    3.0               30 100-03.5
## 3 31283HY42    3.5               30   103-00
## 4 31283HY43    4.0               30   105-13
## 5 31283HY44    4.5               30 107-22.5
## 6 31283HY45    5.0               30 109-22.5</code></pre>
<div id="step-one-define-the-required-input-for-analysis" class="section level2">
<h2>Step One: define the required input for analysis</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">      cusip =<span class="st"> &quot;31283HY43&quot;</span>
      price &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(MBSData, <span class="st">'Select price from MBS where cusip = &quot;31283HY43&quot;'</span>)
      tradedate &lt;-<span class="st"> '05-19-2017'</span>
      settlementdate &lt;-<span class="st"> '06-15-2017'</span>
    <span class="co"># note PriceTypes class is used to convert price from string to</span>
    <span class="co"># numeric decimal equivilant</span>
    Price &lt;-<span class="st"> </span><span class="kw">PriceTypes</span>(<span class="dt">price =</span> <span class="kw">as.character</span>(price))</code></pre></div>
</div>
<div id="step-two-call-the-yield-curve-and-fit-the-term-structure-model" class="section level2">
<h2>Step Two: call the yield curve and fit the term structure model</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   rates.data &lt;-<span class="st"> </span><span class="kw">Rates</span>(<span class="dt">trade.date =</span> tradedate)
   <span class="co"># note use invisible(capture.output()) to supress messages</span>
   <span class="kw">invisible</span>(<span class="kw">capture.output</span>(
     TermStructure &lt;-<span class="st"> </span><span class="kw">TermStructure</span>(<span class="dt">rates.data =</span> rates.data, <span class="dt">method =</span> <span class="st">&quot;dl&quot;</span>)))</code></pre></div>
</div>
<div id="step-three-call-the-mbs-either-by-cusip" class="section level2">
<h2>Step Three: call the MBS either by cusip</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    bond.id &lt;-<span class="st"> </span><span class="kw">MBS</span>(<span class="dt">cusip =</span> cusip)</code></pre></div>
</div>
<div id="step-four-call-the-mortgage-prepayment-model-and-its-dependencies" class="section level2">
<h2>Step Four: call the mortgage prepayment model and its dependencies</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    MortgageRate &lt;-<span class="st"> </span><span class="kw">MtgRate</span>()
    ModelTune &lt;-<span class="st"> </span><span class="kw">ModelTune</span>(<span class="dt">bond.id =</span> bond.id)
    <span class="co">#invoke the prepayment model and assign it to object</span>
    Prepayment &lt;-<span class="st"> </span><span class="kw">PrepaymentModel</span>(<span class="dt">bond.id =</span> bond.id,
                                  <span class="dt">TermStructure =</span> TermStructure,
                                  <span class="dt">MortgageRate =</span> MortgageRate,
                                  <span class="dt">ModelTune =</span> ModelTune,
                                  <span class="dt">PrepaymentAssumption =</span> <span class="st">&quot;MODEL&quot;</span>)</code></pre></div>
</div>
<div id="step-five-call-the-mortgage-cashflow-function" class="section level2">
<h2>Step Five: call the mortgage cashflow function</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PassThrough &lt;-
<span class="st">  </span><span class="kw">MortgageCashFlow</span>(<span class="dt">bond.id =</span> bond.id,
                   <span class="dt">original.bal =</span> <span class="kw">OriginalBal</span>(bond.id),
                   <span class="dt">settlement.date =</span> settlementdate,
                   <span class="co"># note: here price is passed as decimal eqivalent string</span>
                   <span class="co"># internally this function also uses PriceType to convert</span>
                   <span class="co"># price to a numeric decimal basis</span>
                   <span class="dt">price =</span> <span class="kw">PriceDecimalString</span>(Price),
                   <span class="dt">PrepaymentAssumption =</span> Prepayment)</code></pre></div>
</div>
<div id="step-six-optional-but-recommended-calculate-curve-spread" class="section level2">
<h2>Step Six: Optional but recommended, calculate curve spread</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># curve spreads are also returned in the mortgagescenario object</span>
<span class="co"># note: used getter methods on the classes to calculate proceeds</span>
  proceeds =<span class="st"> </span><span class="kw">OriginalBal</span>(bond.id) *<span class="kw">MBSFactor</span>(bond.id) *<span class="st"> </span><span class="kw">PriceBasis</span>(Price)
<span class="co"># The class curve spreads calculates curve spreads for reporting</span>
<span class="co"># or in this case to pass zero volatility spread to the total return function  </span>
  CurveSpreads &lt;-<span class="st"> </span><span class="kw">CurveSpreads</span>(<span class="dt">rates.data =</span> rates.data,
                               <span class="dt">TermStructure =</span> TermStructure,
                               <span class="dt">CashFlow =</span> PassThrough,
                               <span class="dt">proceeds =</span> proceeds)</code></pre></div>
</div>
<div id="step-seven-calculate-total-return" class="section level2">
<h2>Step Seven: Calculate Total Return</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">invisible</span>(<span class="kw">capture.output</span>(
    NoChangeScenario &lt;-<span class="st"> </span><span class="kw">MortgageScenario</span>(
      <span class="dt">bond.id =</span> bond.id,
      <span class="dt">settlement.date =</span> settlementdate,
      <span class="dt">rates.data =</span> rates.data,
      <span class="dt">price =</span> <span class="kw">PriceDecimalString</span>(Price),
      <span class="dt">original.bal =</span> <span class="kw">OriginalBal</span>(bond.id),
      <span class="dt">scenario =</span> <span class="st">&quot;NCs&quot;</span>,
      <span class="dt">horizon.months =</span> <span class="dv">12</span>,
      <span class="dt">method =</span> <span class="st">&quot;ns&quot;</span>,
      <span class="dt">prepayment =</span> <span class="st">&quot;MODEL&quot;</span>,
      <span class="dt">horizon.spot.spread =</span> <span class="kw">ZeroVolSpread</span>(CurveSpreads))))</code></pre></div>
<p>MortgageScenario is a superclass of the following subclasses :TermStructure, PrepaymentAssumption, MortgageCashFlow, MortgageTermStructure, MortgageReturn, ModelToCPR. CurveSpreads, and Scenario. MortgageScenario inherits the getters of each of the above classes.</p>
</div>
<div id="now-lets-get-some-analytics-out-of-the-class-mortgagescenario" class="section level2">
<h2>Now, lets get some analytics out of the class MortgageScenario</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">HorizonReturn</span>(NoChangeScenario)</code></pre></div>
<pre><code>## [1] 2.034823</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ZeroVolSpread</span>(NoChangeScenario)</code></pre></div>
<pre><code>## [1] 1.048002</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">SpreadToCurve</span>(NoChangeScenario)</code></pre></div>
<pre><code>## [1] 1.118964</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">SpreadToBenchmark</span>(NoChangeScenario)</code></pre></div>
<pre><code>## [1] 1.094807</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">BenchMark</span>(NoChangeScenario)</code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">WAL</span>(PassThrough)</code></pre></div>
<pre><code>## [1] 6.647328</code></pre>
</div>
<div id="create-your-own-function" class="section level2">
<h2>Create Your Own Function</h2>
<p>Naturally, one does not wish to replicate the anatomy of a Bond Lab® call repeatedly. The user can create her own function to encapsulate the anatomy of a Bond Lab® call.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyScenario &lt;-<span class="st"> </span>function(<span class="dt">bond.id =</span> <span class="st">&quot;character&quot;</span>,
                       <span class="dt">trade.date =</span> <span class="st">&quot;character&quot;</span>,
                       <span class="dt">settlement.date =</span> <span class="st">&quot;character&quot;</span>,
                       <span class="dt">prepayment =</span> <span class="st">&quot;character&quot;</span>,
                       ...,
                       <span class="dt">price =</span> <span class="ot">NULL</span>,
                       <span class="dt">spread =</span> <span class="ot">NULL</span>,
                       <span class="dt">CPR =</span> <span class="kw">numeric</span>()){
  
  Price &lt;-<span class="st"> </span><span class="kw">PriceTypes</span>(<span class="dt">price =</span> price)
  bond.id &lt;-<span class="st"> </span><span class="kw">MBS</span>(<span class="dt">MBS.id =</span> bond.id)
  rates.data &lt;-<span class="st"> </span><span class="kw">Rates</span>(<span class="dt">trade.date =</span> trade.date)
  MortgageRate &lt;-<span class="st"> </span><span class="kw">MtgRate</span>()
  ModelTune &lt;-<span class="st"> </span><span class="kw">ModelTune</span>(<span class="dt">bond.id =</span> bond.id) 
  
  <span class="kw">invisible</span>(<span class="kw">capture.output</span>(
     TermStructure &lt;-<span class="st"> </span><span class="kw">TermStructure</span>(<span class="dt">rates.data =</span> rates.data, <span class="dt">method =</span> <span class="st">&quot;ns&quot;</span>)))
  
    <span class="co">#invoke the prepayment model and assign it to object</span>
    Prepayment &lt;-<span class="st"> </span><span class="kw">PrepaymentModel</span>(<span class="dt">bond.id =</span> bond.id,
                                  <span class="dt">TermStructure =</span> TermStructure,
                                  <span class="dt">MortgageRate =</span> MortgageRate,
                                  <span class="dt">ModelTune =</span> ModelTune,
                                  <span class="dt">PrepaymentAssumption =</span> prepayment,
                                  <span class="dt">CPR =</span> CPR)
  CashFlow &lt;-
<span class="st">  </span><span class="kw">MortgageCashFlow</span>(<span class="dt">bond.id =</span> bond.id,
                   <span class="dt">original.bal =</span> <span class="kw">OriginalBal</span>(bond.id),
                   <span class="dt">settlement.date =</span> settlementdate,
                   <span class="co"># note: here price is passed as decimal eqivalent string</span>
                   <span class="co"># internally this function also uses PriceType to convert</span>
                   <span class="co"># price to a numeric decimal basis</span>
                   <span class="dt">price =</span> <span class="kw">PriceDecimalString</span>(Price),
                   <span class="dt">PrepaymentAssumption =</span> Prepayment)
  
  <span class="co"># note: used getter methods on the classes to calculate proceeds</span>
  proceeds =<span class="st"> </span><span class="kw">OriginalBal</span>(bond.id) *<span class="kw">MBSFactor</span>(bond.id) *<span class="st"> </span><span class="kw">PriceBasis</span>(Price)
  <span class="co"># The class curve spreads calculates curve spreads for reporting</span>
  <span class="co"># or in this case to pass zero volatility spread to the total return function  </span>
  CurveSpreads &lt;-<span class="st"> </span><span class="kw">CurveSpreads</span>(<span class="dt">rates.data =</span> rates.data,
                               <span class="dt">TermStructure =</span> TermStructure,
                               <span class="dt">CashFlow =</span> PassThrough,
                               <span class="dt">proceeds =</span> proceeds)
  
    <span class="kw">invisible</span>(<span class="kw">capture.output</span>(
      Scenario &lt;-<span class="st"> </span><span class="kw">MortgageScenario</span>(
      <span class="dt">bond.id =</span> bond.id,
      <span class="dt">settlement.date =</span> settlementdate,
      <span class="dt">rates.data =</span> rates.data,
      <span class="dt">price =</span> <span class="kw">PriceDecimalString</span>(Price),
      <span class="dt">original.bal =</span> <span class="kw">OriginalBal</span>(bond.id),
      <span class="dt">scenario =</span> <span class="st">&quot;NCs&quot;</span>,
      <span class="dt">horizon.months =</span> <span class="dv">12</span>,
      <span class="dt">method =</span> <span class="st">&quot;ns&quot;</span>,
      <span class="dt">prepayment =</span> <span class="st">&quot;MODEL&quot;</span>,
      <span class="dt">horizon.spot.spread =</span> <span class="kw">ZeroVolSpread</span>(CurveSpreads))))
    
    <span class="kw">return</span>(Scenario)

}</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
